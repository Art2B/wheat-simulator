var t,e,r=((t=r||{})[t.wheat=0]="wheat",t[t.parsnip=1]="parsnip",t[t.bread=2]="bread",t);const a={wheat:{materials:null,baseCraftTime:1e3,farmable:!0},parsnip:{materials:null,baseCraftTime:1e3,farmable:!0},bread:{materials:[{type:"wheat",quantity:2}],baseCraftTime:1e3,farmable:!1}};class s{static isRessource(t){return t in r}static isPlantableRessource(t){return t in r&&a[t].farmable}static isCraftableRessource(t){return t in r&&!!a[t].materials}static getRessourceFromString(t){return t&&s.isRessource(t)?t:null}}const i=Object.entries(a).filter(([t])=>s.isCraftableRessource(t)).reduce((t,[e,r])=>{let a=s.getRessourceFromString(e);return a&&(t[a]=r),t},{}),n=Object.entries(a).filter(([t])=>s.isPlantableRessource(t)).reduce((t,[e,r])=>{let a=s.getRessourceFromString(e);return a&&(t[a]=r),t},{});var o=((e=o||{}).fallow="fallow",e.seeding="seeding",e.growth="growth",e.mature="mature",e);class l{element;actionsContainer;_state="fallow";timeModifier=1;yieldModifier=1;ressource=null;growingTimeout=null;constructor(t){this.state="fallow",this.element=this.generateFieldElement(t),this.actionsContainer=this.generateActionContainer(),this.setActions()}get state(){return this._state}set state(t){this._state=t,this.element&&(this.element.dataset.state=t,this.setActions())}generateFieldElement(t){let e=document.createElement("field-block");return e.dataset.state=this.state,t.appendChild(e),e}generateActionContainer(){if(!this.element)throw Error("There is no element in Field class");let t=document.createElement("div");return t.setAttribute("slot","actions"),this.element.appendChild(t),t}setActions(){this.actionsContainer.innerHTML="","fallow"===this.state?this.generatePlantButtons():"growth"===this.state||"seeding"===this.state?this.actionsContainer.innerHTML='<button data-action="harvest" disabled>Harvest field</button>':"mature"===this.state&&(this.actionsContainer.innerHTML='<button data-action="harvest">Harvest field</button>',this.actionsContainer.querySelectorAll('button[data-action="harvest"]').forEach(t=>{t.addEventListener("click",this.handleHarvest.bind(this))}))}generatePlantButtons(){Object.keys(n).map(t=>s.getRessourceFromString(t)).filter(t=>!!t).forEach(t=>{let e=document.createElement("button");e.dataset.action="plant",e.dataset.ressource=t,e.textContent=`Plant ${t}`,e.addEventListener("click",this.handleActionPlant.bind(this)),this.actionsContainer.appendChild(e)})}handleActionPlant(t){let e=s.getRessourceFromString(t.target.dataset.ressource);e&&s.isPlantableRessource(e)&&this.plant(e)}handleHarvest(){this.state="fallow",this.ressource&&(window.$inventory[this.ressource]+=+this.yieldModifier),this.ressource=null,this.growingTimeout&&clearTimeout(this.growingTimeout),this.growingTimeout=null}plant(t){this.state="seeding",this.ressource=t,this.growingTimeout=setTimeout(()=>{this.state="mature"},a[t].baseCraftTime*this.timeModifier)}}const c={wheat:0,bread:0,parsnip:0},u={set(t,e,r){let a=Reflect.set(t,e,r),s=document.querySelectorAll(`[data-inventory="${e}"]`);if(s.length>0)s.forEach(t=>{t.innerHTML=`${r} ${e}`});else{let t=document.createElement("li");t.setAttribute("data-inventory",e),t.innerText=`${r} ${e}`,document.querySelector("#ressource-list")?.appendChild(t)}for(let[e,r]of Object.entries(i)){let a=document.querySelectorAll(`[data-action="craft"][data-ressource="${e}"]`);r.materials&&r.materials.every(e=>{let r=t[e.type];return r&&r>=e.quantity})?a.forEach(t=>{t.disabled=!1}):a.forEach(t=>{t.disabled=!0})}return a}};window.$inventory=function(t={}){return new Proxy({...c,...t},u)}();class d{static craft(t){console.log("Must craft this: ",t);let e=a[t].materials;if(e&&e.every(t=>window.$inventory[t.type]>=t.quantity)){for(let t of e)window.$inventory[t.type]-=t.quantity;window.$inventory[t]+=1}}}document.querySelectorAll('button[data-action="craft"]').forEach(t=>{t.addEventListener("click",t=>{let e=s.getRessourceFromString(t.target.dataset.ressource);e&&d.craft(e)})});const h=document.querySelector("#field-container");if(h)for(let t=0;t<3;t++)new l(h);
//# sourceMappingURL=wheat-simulator.b1ca83ed.js.map
